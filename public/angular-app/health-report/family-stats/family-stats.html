<style>
    svg {
        font: 10px sans-serif;
    }

    .background path {
        fill: none;
        stroke: #ddd;
    }

    .foreground path {
        fill: none;
        stroke: steelblue;
    }

    .brush .extent {
        fill-opacity: .3;
        stroke: #fff;
        shape-rendering: crispEdges;
    }

    .axis line,
    .axis path {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .axis text {
        fill: black;
        text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
        cursor: move;
    }
</style>

<script type="text/ng-template" id="editAllTasks">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title pull-left">Edit Tasks</h5>
            <button type="button" class="close pull-right" ng-click="cancel()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="panel panel-default">
                <div class="panel-heading" style="padding-top: 10px; padding-bottom: 5px">
                    <p class="pull-right textAlignMiddle"><span class="glyphicon glyphicon-remove-circle" style="color: red"></span> Incomplete</p>
                    <p class="pull-right textAlignMiddle"><span class="glyphicon glyphicon-ok-circle" style="color: green"></span> Complete</p>
                    <input type="checkbox" value="Name:" id="mainCheckbox" ng-model="check" ng-change="selectAll(check)">
                    <label style="padding-left: 10px">Name:</label>
                </div>
                <ul class="list-group">
                    <li class="list-group-item" ng-repeat="task in family.tasks | orderBy: task.name : false">
                        <div class="checkbox">
                            <input type="checkbox" ng-attr-id="{{'checkbox' + $index}}" ng-model="task.isSelected"/>
                            <label style="padding-left: 5px" ng-attr-for="{{'checkbox' + $index}}">{{task.name}}</label>
                        </div>
                        <div class="pull-right action-buttons">
                            <span ng-if="task.completedBy != null" class="glyphicon glyphicon-ok-circle" style="color: green;"></span>
                            <span ng-if="task.completedBy == null" class="glyphicon glyphicon-remove-circle" style="color: red"></span>
                            <a href=""><span class="glyphicon glyphicon-pencil" ng-click="openEditModal('', task, family.name)"></span></a>
                        </div>
                    </li>
                </ul>
                <div class="panel-footer" style="padding-top: 5px; padding-bottom: 5px">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>
                                Total Tasks: <span class="label label-info">{{family.tasks.length}}</span>
                            </h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-danger pull-left" ng-click="delete()"><span class="glyphicon glyphicon-trash"></span> Delete</button>
            <button type="button" class="btn btn-secondary" ng-click="cancel()">Close</button>
            <button type="button" class="btn btn-primary" ng-click="addTask()"><span class="glyphicon glyphicon-plus"></span> Add Task</button>
        </div>
    </div>
</script>

<script type="text/ng-template" id="editSingleTask">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title pull-left">Edit Task</h5>
            <button type="button" class="close pull-right" ng-click="cancel()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <form>
                <div class="form-group">
                    <label class="form-control-label">Family Info:</label>
                    <label class="form-control">{{family.name}}</label>
                </div>
                <div class="col-md-6 no-padding-left">
                    <div class="form-group">
                        <label for="task-name" class="form-control-label">
                            Task Name:
                            <span class="glyphicon glyphicon-ok small" style="color: green;" ng-if="task.name && !task.completedBy"></span>
                            <span class="glyphicon glyphicon-asterisk small" style="color: red;" ng-if="!task.name && !task.completedBy"></span>
                        </label>
                        <input type="text" class="form-control" id="task-name" value="task.name" ng-model="task.name" ng-disabled="task.completedBy">
                    </div>
                </div>
                <div class="col-md-6 no-padding-right">
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">
                            Recipient:
                            <span class="glyphicon glyphicon-ok small" style="color: green;" ng-if="task.assignedTo && !task.completedBy"></span>
                            <span class="glyphicon glyphicon-asterisk small" style="color: red;" ng-if="!task.assignedTo && !task.completedBy"></span>
                        </label>
                        <input type="text" class="form-control" id="recipient-name" value="task.assignedTo" ng-model="task.assignedTo" ng-disabled="task.completedBy">
                    </div>
                </div>
                <div class="form-group">
                    <label for="message-text" class="form-control-label">
                        Message:
                        <span class="glyphicon glyphicon-ok small" style="color: green;" ng-if="task.message && !task.completedBy"></span>
                        <span class="glyphicon glyphicon-asterisk small" style="color: red;" ng-if="!task.message && !task.completedBy"></span>
                    </label>
                    <textarea class="form-control" id="message-text" ng-model="task.message" ng-disabled="task.completedBy"></textarea>
                </div>
                <div class="form-group" ng-if="task.completedBy">
                    <label for="comments-text" class="form-control-label">
                        Comments:
                        <span class="glyphicon glyphicon-ok small" style="color: green;" ng-if="task.message && !task.completedBy"></span>
                        <span class="glyphicon glyphicon-asterisk small" style="color: red;" ng-if="!task.message && !task.completedBy"></span>
                    </label>
                    <textarea class="form-control" id="comments-text" ng-model="task.comments" ng-disabled="task.completedBy"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary pull-left" ng-click="back('', family)"><span class="glyphicon glyphicon-chevron-left">Back</span></button>
            <button type="button" class="btn btn-secondary" ng-click="cancel()">Close</button>
            <button type="button" class="btn btn-primary" ng-click="reopenTask()" ng-if="task.completedBy">Re-Open</button>
            <button type="button" class="btn btn-primary" ng-click="updateTask()" ng-if="!task.completedBy">Update</button>
        </div>
    </div>
</script>

<script type="text/ng-template" id="addTask">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title pull-left">Add Task</h5>
            <button type="button" class="close pull-right" ng-click="cancel()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <form>
                <div class="form-group">
                    <label class="form-control-label">Family Info:</label>
                    <label class="form-control">{{family.name}}</label>
                </div>
                <div class="col-md-6 no-padding-left">
                    <div class="form-group">
                        <label for="task-name" class="form-control-label">
                            Task Name:
                            <span class="glyphicon glyphicon-ok small" style="color: green;" ng-if="task.name"></span>
                            <span class="glyphicon glyphicon-asterisk small" style="color: red;" ng-if="!task.name"></span>
                        </label>
                        <input type="text" class="form-control" value="{{task.name}}" ng-model="task.name">
                    </div>
                </div>
                <div class="col-md-6 no-padding-right">
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">
                            Recipient:
                            <span class="glyphicon glyphicon-ok small" style="color: green;" ng-if="task.assignedTo"></span>
                            <span class="glyphicon glyphicon-asterisk small" style="color: red;" ng-if="!task.assignedTo"></span>
                        </label>
                        <input type="text" class="form-control" value="{{task.assignedTo}}" ng-model="task.assignedTo">
                    </div>
                </div>
                <div class="form-group">
                    <label for="message-text" class="form-control-label">
                        Message:
                        <span class="glyphicon glyphicon-ok small" style="color: green;" ng-if="task.message"></span>
                        <span class="glyphicon glyphicon-asterisk small" style="color: red;" ng-if="!task.message"></span>
                    </label>
                    <textarea class="form-control" ng-model="task.message"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" ng-click="cancel()">Close</button>
            <button type="button" class="btn btn-primary" ng-click="addTask()"><span class="glyphicon glyphicon-plus"></span> Add</button>
        </div>
    </div>
</script>
<div class="container-fluid">
    <div class="row">
        <div class="panel-group">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">Families Health Score:</h4>
                </div>
                <div class="panel-collapse">
                    <div class="panel-body">
                        <div class="col-md-3">
                            <d3-circle data="vm.FamilyData.scoreData" class="cn"></d3-circle>
                        </div>
                        <div class="col-md-4">
                            <div class="small">
                                <p>
                                    {{vm.FamilyData.description}}
                                </p>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div id="menu">
                                <div class="panel list-group">
                                    <a href="" class="list-group-item" data-toggle="collapse" data-target="#sm" data-parent="#menu">
                                        Unplaced Families
                                        <span ng-class="vm.FamilyData.unusedFamilies <= 10
                                ? 'badge progress-bar-success'
                                : vm.FamilyData.unusedFamilies > 10 && vm.FamilyData.unusedFamilies <= 20
                                ? 'badge progress-bar-warning'
                                : 'badge progress-bar-danger' ">{{vm.FamilyData.unusedFamilies}}</span>
                                    </a>
                                    <div id="sm" class="sublinks collapse">
                                        <div class="list-group-item small">
                                            Families are integral part of Revit project. However, unused/unplaced Families unnecessarily bloat file size
                                            and degrade performance. Less than 10 is green, more than 10 but less than 20 is orange while more than 20 is red.
                                        </div>
                                    </div>
                                    <a href="" class="list-group-item" data-toggle="collapse" data-target="#sl" data-parent="#menu">
                                        InPlace Families
                                        <span ng-class="vm.FamilyData.inPlaceFamilies <= 5
                                ? 'badge progress-bar-success'
                                : vm.FamilyData.inPlaceFamilies > 5 && vm.FamilyData.inPlaceFamilies <= 10
                                ? 'badge progress-bar-warning'
                                : 'badge progress-bar-danger' ">{{vm.FamilyData.inPlaceFamilies}}</span>
                                    </a>
                                    <div id="sl" class="sublinks collapse">
                                        <div class="list-group-item small">
                                            Usage of InPlace families should be limited to minimum possible. InPlace Families cannot be scheduled, hence limited in traditional
                                            usage. They are also constrained to given model, and cannot be reused on other projects.
                                        </div>
                                    </div>
                                    <a href="" class="list-group-item" data-toggle="collapse" data-target="#s2" data-parent="#menu">
                                        Misnamed Families
                                        <span ng-class="vm.FamilyData.misnamed <= 10
                                ? 'badge progress-bar-success'
                                : vm.FamilyData.misnamed > 10 && vm.FamilyData.misnamed <= 20
                                ? 'badge progress-bar-warning'
                                : 'badge progress-bar-danger'">{{vm.FamilyData.misnamed}}</span>
                                    </a>
                                    <div id="s2" class="sublinks collapse">
                                        <div class="list-group-item small">
                                            It's considered good practive to use HOK created and curated families. These families will typically have a name containing "_HOK" in it.
                                            Family naming has no performance impact, but is good practice that should be followed. Less than 10 is green, more than 10 but less
                                            than 20 is orange while more than 20 is red.
                                        </div>
                                    </div>
                                    <a href="" class="list-group-item" data-toggle="collapse" data-target="#s3" data-parent="#menu">
                                        Oversized Families
                                        <span ng-class="vm.FamilyData.oversizedFamilies <= 10
                                ? 'badge progress-bar-success'
                                : vm.FamilyData.oversizedFamilies > 10 && vm.FamilyData.oversizedFamilies <= 20
                                ? 'badge progress-bar-warning'
                                : 'badge progress-bar-danger'">{{vm.FamilyData.oversizedFamilies}}</span>
                                    </a>
                                    <div id="s3" class="sublinks collapse">
                                        <div class="list-group-item small">
                                            Anything over 1MB will be considered oversized. Large families can be a good indicator of mismodelled or families with imported
                                            CAD objects. Generally it's a good idea to keep Family file size low. Less than 10 is green, more than 10 but less than 20 is orange while more than 20 is red.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="panel-group">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class=" btn-group btn-group-xs pull-right" role="group" aria-hidden="true">
                        <button type="button" ng-class="vm.SelectedYear === '2016' ? 'btn btn-primary' : 'btn btn-primary'" ng-click="vm.FilterTable()">Filter</button>
                    </div>
                    <h4 class="panel-title" style="padding-top: 5px;">Select: Filter Families by Multiple Parameters.</h4>
                </div>
                <div class="panel-collapse">
                    <div class="panel-body">
                        <d3-parallel-coordinates data="vm.pcoordinatesData" format-value="vm.formatValue(item)" d3-on-brush="vm.OnBrush(item)"></d3-parallel-coordinates>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="panel-group" id="p1">
            <div class="panel panel-default">
                <div class="panel-heading panel-heading-clickable" data-toggle="collapse" data-parent="#p1" data-target="#collapseP1">
                    <p class="pull-right textAlignMiddle"><span class="glyphicon glyphicon-stop" style="color: #F0AD4E"></span> 2/3 Fail</p>
                    <p class="pull-right textAlignMiddle"><span class="glyphicon glyphicon-stop" style="color: #D9534F"></span> All checks Fail</p>
                    <h4 class="panel-title">Family Checks: no placed instances, >1MB size, misnamed</h4>
                </div>
                <div id="collapseP1" class="panel-collapse collapse in">
                    <div class="panel-body">
                        <table id="table1" datatable="ng" dt-options="vm.dtOptions" dt-column-defs="vm.dtColumnDefs" class="table table-hover table-condensed datatable">
                            <thead>
                            <tr>
                                <th class="col-md-1 text-center">#</th>
                                <th class="col-md-9">Name</th>
                                <th class="col-md-1 text-center">Qty.</th>
                                <th class="col-md-1 text-center">Size</th>
                                <th>Size Value</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="i in vm.AllFamilies | orderBy: 'name' : false" ng-class="vm.evaluateFamily(i) == 3 ? 'bg-danger' : vm.evaluateFamily(i) == 2 ? 'bg-warning' : 'table-info'">
                                <td class="text-center">{{$index}}</td>
                                <td ng-mouseenter="onHover = true" ng-mouseleave="onHover = false">
                                    <p ng-class="vm.evaluateName(i) ? 'normal' : 'thick'">
                                        {{i.name}}
                                        <a href="">
                                            <span ng-show="i.tasks.length > 0 || onHover" class="glyphicon glyphicon-tasks" ng-click="i.tasks.length > 0 ? vm.openAllTasksWindow('',i) : vm.openAddWindow('', i)"></span>
                                        </a>
                                    </p>
                                </td>
                                <td class="text-center"><p ng-class="vm.evaluateInstances(i) ? 'normal' : 'thick'">{{i.instances}}</p></td>
                                <td class="text-center"><p ng-class="vm.evaluateSize(i) ? 'normal' : 'thick'">{{i.size}}</p></td>
                                <td class="text-center">{{i.sizeValue}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>